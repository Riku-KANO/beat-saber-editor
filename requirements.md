# Beat Saber Editor 要件定義書

## 1. プロジェクト概要

### 1.1 目的
一般ユーザーが自分で作成した楽曲からBeat Saberの譜面を直感的に作成できるWebベースの3Dエディターを提供する。

### 1.2 対象ユーザー
- 一般ユーザー（プログラミング知識不要）
- 自作楽曲でBeat Saber譜面を作成したいクリエイター
- 直感的な操作を重視するユーザー

### 1.3 プロジェクトの特徴
- **使いやすさ重視**: 直感的なUI/UX
- **XR活用**: VR/ARでの没入感のある編集体験
- **Webベース**: インストール不要、ブラウザで完結
- **3D視覚化**: リアルタイムでの3D譜面プレビュー

## 2. 機能要件

### 2.1 基本編集機能
- **楽曲インポート**: MP3、WAV、OGG、FLAC形式の音声ファイル対応
- **オブジェクト配置**: 赤/青ブロック、爆弾、壁障害物の配置
- **キーフレーム編集**: 時間軸に沿ったオブジェクトの動き設定
- **カット方向指定**: ブロックの切る方向（8方向+ドット）
- **3D/2D切り替え**: 3D空間での直感的編集と2D精密編集

### 2.2 タイムライン機能
- **高性能タイムライン**: PixiJS使用の滑らかな描画
- **波形表示**: 音声の波形可視化
- **BPM設定**: 楽曲のテンポ設定
- **拍子記号**: 4/4拍子等の設定
- **グリッド表示**: 16分音符単位でのスナップ機能

### 2.3 プレビュー機能
- **リアルタイム再生**: 作成中譜面の即座プレビュー
- **Beat Saberシミュレーション**: 実際のゲーム環境での動作確認
- **デュアルモード**: Editor/Previewタブ切り替え

### 2.4 XR（VR/AR）機能
- **VR/ARモード**: WebXR対応のVR/AR表示
- **ハンドトラッキング**: 手による直接操作
- **空間編集**: 3D空間内での直感的なオブジェクト操作
- **XR編集インターフェース**: VRコントローラー対応（要実装）

### 2.5 難易度設定機能
- **難易度レベル**: Easy、Normal、Hard、Expert、Expert+
- **難易度別譜面**: 同一楽曲の複数難易度対応
- **パラメータ設定**: 各難易度のNJS（Note Jump Speed）等

### 2.6 プロジェクト管理
- **プロジェクト保存**: ローカルストレージへの自動保存
- **プロジェクト読み込み**: 過去のプロジェクト継続編集
- **エクスポート機能**: 完成譜面のファイル出力

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **音声ファイル**: 最大30MB、一般的な楽曲長（3-6分）対応
- **オブジェクト数**: 一般的な譜面規模（数千オブジェクト）での滑らかな動作
- **フレームレート**: 60FPS以上での3D描画
- **メモリ使用量**: WebGL最適化によるメモリ効率化

### 3.2 互換性要件
- **ブラウザ対応**: Chrome、Firefox、Safari、Edge（WebGL対応）
- **WebXR対応**: Meta Quest、HTC Vive等のVRデバイス
- **デバイス対応**: PC、タブレット（スマートフォンは対象外）

### 3.3 可用性要件
- **オフライン動作**: ローカル実行、ネットワーク不要
- **データ永続化**: プロジェクトデータの安全な保存
- **エラー処理**: 音声ファイル読み込みエラー等の適切なハンドリング

## 4. 技術要件

### 4.1 フロントエンド技術
- **React 19**: 最新のReactフレームワーク
- **TypeScript**: 型安全な開発
- **React Three Fiber**: 3D WebGL描画
- **PixiJS**: 高性能2Dタイムライン描画

### 4.2 3D/XR技術
- **Three.js**: 3Dグラフィックスエンジン
- **@react-three/xr**: WebXR統合
- **WebGL**: GPU加速3D描画

### 4.3 音声処理
- **Web Audio API**: 音声ファイル処理・再生
- **AudioContext**: リアルタイム音声制御

### 4.4 状態管理
- **Zustand**: 軽量状態管理ライブラリ
- **Local Storage**: プロジェクトデータ永続化

## 5. データ要件

### 5.1 プロジェクトデータ構造
```typescript
interface EditorProject {
  id: string;
  name: string;
  audioFile: File;
  bpm: number;
  beatsPerMeasure: number;
  difficulties: Difficulty[];
  createdAt: Date;
  updatedAt: Date;
}

interface Difficulty {
  level: 'Easy' | 'Normal' | 'Hard' | 'Expert' | 'Expert+';
  objects: EditorObject[];
  njs: number; // Note Jump Speed
}

interface EditorObject {
  id: string;
  type: 'block' | 'bomb' | 'obstacle' | 'saber' | 'effect';
  color: 'red' | 'blue' | 'gray';
  cutDirection: number; // 0-8 (8 directions + dot)
  keyframes: Keyframe[];
}

interface Keyframe {
  time: number;
  position: [number, number, number];
  rotation: [number, number, number];
}
```

### 5.2 対応音声フォーマット
- **MP3**: 最も一般的な形式
- **WAV**: 高品質音声
- **OGG**: オープンソース形式
- **FLAC**: 可逆圧縮形式

## 6. UI/UX要件

### 6.1 インターフェース設計
- **デュアルモード**: Editor（編集）/Preview（プレビュー）タブ
- **分割レイアウト**: 3Dビュー/2Dビュー/タイムライン
- **レスポンシブ**: 異なる画面サイズへの対応
- **ダークモード**: 目の負担軽減

### 6.2 操作性
- **直感的操作**: ドラッグ&ドロップでの配置
- **キーボードショートカット**: 効率的な編集操作
- **undo/redo**: 操作の取り消し・やり直し
- **プリセット**: よく使用するパターンの保存

### 6.3 視覚化
- **リアルタイム3D**: 編集中の即座フィードバック
- **波形表示**: 音声の視覚的な把握
- **グリッド**: 正確な配置のガイド
- **カラーコーディング**: オブジェクトタイプの色分け

## 7. 制約事項

### 7.1 技術的制約
- **Webブラウザ環境**: デスクトップアプリケーションの機能制限
- **WebGL性能**: ハードウェア依存のパフォーマンス
- **ファイルサイズ**: 30MB音声ファイル制限

### 7.2 機能制約
- **Beat Saber公式フォーマット**: 互換性は重視しない
- **多言語対応**: 当面は日本語/英語のみ
- **商用利用**: 非商用プロジェクト

## 8. 今後の拡張可能性

### 8.1 追加機能候補
- **AIアシスト**: 楽曲解析による自動譜面生成
- **コミュニティ機能**: 譜面共有・評価システム
- **エフェクト**: 光演出やパーティクルエフェクト
- **マルチプレイヤー**: 協調編集機能

### 8.2 技術的拡張
- **PWA化**: オフラインでの完全動作
- **WebAssembly**: 高性能音声処理
- **Machine Learning**: 楽曲解析・譜面最適化

---

**文書作成日**: 2025年7月16日  
**バージョン**: 1.0  
**作成者**: Claude Code